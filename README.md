### Recsys: RecЛаматоры

- **Цель**: рекомендовать 10 фильмов каждому пользователю на основе истории оценок.
- **Метрика**: Recall@10.
- **Сабмиты**:
  - `submission_sasrec.csv` (лучший из двух по валидации)
  - `submission_two_stage.csv`
  - `submission_popularity.csv` 

### Содержимое репозитория
- `recsys_sasrec.ipynb` — основной ноутбук, в котором реализованы:
  - SASRec (RePlay)
  - Двухэтапный подход: кандидаты (Spark ALS) → LGBM Ranker для rerank’а
  - Подсчёт Recall@10 и формирование всех трёх сабмитов
- `submission_sasrec.csv`, `submission_two_stage.csv`, `submission_popularity.csv` — итоговые файлы рекомендаций (после запуска ноутбука)

### Данные (ожидаемый формат)
- `events.csv`: `user_id,item_id,timestamp[,rating]`
  - `timestamp` — числовой (сек/мс) или ISO-строка; в ноутбуке предусмотрен устойчивый парсинг
  - `rating` — опционально, по умолчанию 1.0
- `user_features.csv`, `item_features.csv` — опционально (используются при желании для дополнительных фич)
- `submission_sample.csv` — образец формата сабмита: два столбца `user_id,item_id`, где во втором — 10 id через пробел


### Реализованные модели
- **SASRec (RePlay)**:
  - Обучается на трейне, предсказывает топ‑10 для каждого пользователя
  - Файл: `submission_sasrec.csv`
- **Двухэтапный подход**:
  - Кандидаты: Spark ALS (Top‑300 на пользователя)
  - Реранкер: LightGBM (`LGBMRanker`, objective=`lambdarank`), обучение на трейне с leave‑last‑1 позитивами
  - Файл: `submission_two_stage.csv`
- **Лучший сабмит**:
  - Сравнение Recall@10 на валидации (time‑based split, 80/20)
  - Файл: `submission_sasrec.csv`

### Метрика
- `Recall@10` считается по пользователям валидации как среднее доли истинных релевантов, попавших в топ‑10.
- Сплит по времени (квантиль 0.8 по `timestamp`) обеспечен в ноутбуке; для SASRec также доступен LOO‑вариант для быстрой проверки.

### Гарантия 10 рекомендаций (ensure_top10)
- Если у пользователя меньше 10 кандидатов, недостающее добивается по глобальной популярности (без дубликатов).

### Роли (шаблон)
- MLOps — Астемир Жуков: координация, сборка финального ноутбука, метрики, README.
- ML‑инженер — Владислав Спевак: реализация и обучение SASRec (RePlay).
- ML‑инженер — Молоков Николай: реализация ALS + LightGBM пайплайна.
- Аналитик — Иван Захаров: фичер инжинирг, подготовка данных.


### Советы по окружению
- Spark ALS требует Java 11. На macOS:
  - `brew install --cask temurin@11`
  - `export JAVA_HOME=$(/usr/libexec/java_home -v 11)`
- В Colab первая ячейка ноутбука пинует версии `numpy/scipy/pandas` и инициирует перезапуск ядра — это нормально и предотвращает ABI‑ошибки.


### Обновления по структуре репозитория
- Добавлены ноутбуки в корень:
  - `recsys.ipynb` — основной рабочий ноутбук (SASRec + Two‑Stage)
  - `recsys_sasrec.ipynb` — вспомогательный ноутбук (второй вариант пайплайна/черновик)
  - `hypothesis_test.ipynb` — вспомогательный ноутбук (проверки/гипотезы)
- Итоговые сабмиты формируются в корне репозитория:
  - `submission_sasrec.csv`
  - `submission_two_stage.csv`
  - `submission_popularity.csv`

### Быстрый старт
  1) Откройте `recsysc.ipynb`
  2) Выполните первую ячейку Setup (установки), дождитесь перезапуска ядра
  3) Выполните все ячейки сверху вниз; сабмиты появятся в рабочей директории


